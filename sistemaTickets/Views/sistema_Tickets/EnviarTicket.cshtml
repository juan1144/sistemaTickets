@model sistemaTickets.Models.usuario
@{
}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Subir Nuevo Ticket</title>
  <!-- Enlace al archivo CSS externo -->
  <link rel="stylesheet" href="~/css/EnviarTicket.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto&display=swap">
</head>
<body>

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="user-profile">
            <img src="@Model.imagen" alt="Foto de perfil">
            <div class="user-info">
                <span class="name">@Model.nombre @Model.apellido</span>
            </div>
        </div>
        <a href="@Url.Action("EnviarTicket", "sistema_Tickets", new { userId = Model.id_usuario })">
            <div class="option">

                <img src="~/images/Ticket image.png" alt="Ticket">
                <span>Enviar un Ticket</span>

            </div>
        </a>
        <div class="option">
            <img src="~/images/History image.png" alt="Historial">
            <span>Historial de Tickets</span>
        </div>
        <div class="option">
            <img src="~/images/user.png" alt="usuarios">
            <span>Gestionar usuarios</span>
        </div>
        <div class="option">
            <img src="~/images/dashboard.png" alt="Dashboard">
            <span>Dashboard</span>
        </div>
    </aside>

  <!-- Contenido principal -->
  <div class="content">
        <h1 style="text-align: center;">Nuevo Ticket</h1>
    <div class="form-container">
      <form asp-action="SubirTicket" method="post" enctype="multipart/form-data" onsubmit="return validateForm()">
        <div class="input-group">
            <label for="application">Aplicación</label>
            @Html.DropDownList("id_aplicacion", ViewBag.Aplicaciones as SelectList, "Seleccione una aplicación", new { @class = "form-control", @id = "application", @name = "application" })
        </div>
        <div class="input-group">
          <label for="subject">Asunto</label>
          <input type="text" id="subject" name="subject" placeholder="Ingrese el asunto">
        </div>
        <div class="input-group">
          <label for="description">Descripción</label>
          <textarea id="description" name="description" rows="4" placeholder="Ingrese la descripción"></textarea>
        </div>
        <div class="input-group">
          <label for="priority">Prioridad</label>
          <select id="priority" name="priority">
            <option value="">Seleccionar...</option>
            <option value="alta">Alta</option>
            <option value="media">Media</option>
            <option value="baja">Baja</option>
          </select>
        </div>
        <div class="input-group">
            <label for="category">Categoría</label>
            @Html.DropDownList("id_categorias", ViewBag.Categorias as SelectList, "Seleccione una categoría", new { @class = "form-control", @id = "category", @name = "category" })
        </div>
        <div class="input-group">
          <label for="attachment">Adjuntar Archivo</label>
          <input type="file" id="attachment" name="attachment">
        </div>
        <input type="hidden" id="userId" name="userId" value="@Model.id_usuario">
        <div class="error-message" id="error-message"></div>
        <button type="submit">Enviar Ticket</button>
      </form>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
        var rolID = @Model.rolID;

        // Mostrar solo las opciones "Enviar un Ticket" y "Historial de Tickets" para rolID 1 o 3
        if (rolID === 1 || rolID === 3) {
            document.querySelectorAll('.option').forEach(function (opcion, index) {
                if (index === 0 || index === 1) {
                    opcion.style.display = 'flex';
                } else {
                    opcion.style.display = 'none';
                }
            });
        }
        // Mostrar todas las opciones para rolID 2
        else if (rolID === 2) {
            document.querySelectorAll('.option').forEach(function (opcion) {
            opcion.style.display = 'flex';
            });
        }
    });
    function validateForm() {
      var application = document.getElementById('application').value;
      var subject = document.getElementById('subject').value;
      var description = document.getElementById('description').value;
      var priority = document.getElementById('priority').value;
      var category = document.getElementById('category').value;
      var attachment = document.getElementById('attachment').value;
      var errorMessage = document.getElementById('error-message');

      if (application === '' || subject.trim() === '' || description.trim() === '' || priority === '' || category === '') {
        errorMessage.textContent = 'Por favor complete todos los campos';
        return false;
      } else {
        errorMessage.textContent = '';
        // Aquí podrías agregar la lógica para enviar los datos del formulario al servidor
        return true;
      }
    }

  </script>
</body>
</html>
